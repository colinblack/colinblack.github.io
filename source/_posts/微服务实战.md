---
title: 微服务实战
date: 2020-11-14 18:43:00
tags:
categories:
    - 微服务
---

<!-- more -->
微服务实战

### PHP电商单体应用准备　

#### 基于 Laravel 开源项目 Laracom 快速构建在线商城系统
##### 1. 环境准备　
开始之前，需要确保本地具备以下软件:
* PHP 7.1+
* Composer
* Git

##### 2. 安装Homestead 
1. 安装vagrant
直接去官网下载:
https://www.vagrantup.com/downloads

2. 将 Homestead Vagrant 盒子 laravel/homesterad 添加到 Vagrant 中
```shell
	vagrant box add laravel/homestead
```
  选择３
  <img src="https://i.loli.net/2020/10/25/Bh8J2wVa6ZErOy7.png"/>

3. 克隆Homestead，克隆完成后，你需要检查 Homestead 的版本标签，因为 master 分支不会总是稳定版本，你可以在 [GitHub Release Page](https://github.com/laravel/homestead/releases) 查找到最新稳定版本然后在本地将其检出
```shell
	cd ~/Homestead
	git checkout v11.3.0
```

4. 执行初始化脚本
```shell
	bash init.sh
```
5. 配置 Homestead
```shell
	cd ~/Homestead
	cp Homestead.yaml.example Homestead.yaml
	
	#修改配置如下
	ip: "192.168.10.10"
    memory: 2048
    cpus: 2
    provider: virtualbox

    authorize: ~/.ssh/id_rsa.pub

    keys:
        - ~/.ssh/id_rsa

    folders:
        - map: /home/cp/data/laracom
          to: /home/vagrant/laracom
          type: "rsync"
          options:
              rsync__args: ["--verbose", "--archive", "--delete", "-zz"]
              rsync__exclude: ["node_modules"]

    sites:
        - map: laracom.test
          to: /home/vagrant/laracom/public

    databases:
        - laracom

    features:
        - mariadb: false
        - ohmyzsh: false
        - webdriver: false
        - backup: true

    # ports:
    #     - send: 50000
    #       to: 5000
    #     - send: 7777
    #       to: 777
    #       protocol: udp
```
6. 安装virtualbox  

```shell
   sudo apt install  virtualbox
```
##### 安装Laracom
1. 安装Composer
```shell
	
	curl -sS https://getcomposer.org/installer | php
	mv composer.phar /usr/local/bin/composer
```
2. 创建Laracom 
```shell
	composer create-project jsdecena/laracom --prefer-dist  --ignore  -platform-reqs
```
3. 进入Laracom根目录，修改环境配置文件.env
```shell
	#注意是laracom根目录
	cd ~/laracom
	
	＃.env文件中修改如下
    APP_URL=http://laracom.test

    DB_CONNECTION=mysql
    DB_HOST=127.0.0.1
    DB_PORT=3306
    DB_DATABASE=laracom
    DB_USERNAME=homestead
    DB_PASSWORD=secret
```

4. 安装前端依赖并编译前端资源
```shell
	npm install
	npm run dev
```
5. 配置Homestead
　参考2.5中的配置

6. 重启虚拟机
```shell
	vagrant reload --provision
```

7. 登录虚拟机, 进入项目根目录运行数据库迁移和填充命令
```shell
	vagrant ssh
    cd /home/vagrant/laracom
    composer install
    php artisan migrate --seed
```
　执行数据库迁移时如果.env中配置的数据库没有创建(上面的配置数据库为laracom)要自行创建
　```sql
	create database laracom
　```
8. 生成文件上传目录软链接
```shell
	php artisan storage:link
```

9. 访问构建的网页
　　在浏览器中通过 http://laracom.test 访问

参考:   
  [重量级开发环境：Homestead](https://xueyuanjun.com/post/19915.html)  
  [基于 Laravel 开源项目 Laracom 快速构建在线商城系统](https://xueyuanjun.com/post/20000)

  